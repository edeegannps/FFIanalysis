library(ggforce)
tree$Date_format=as.Date(tree$Date, format="%m/%d/%Y")
library(stringr)
tree$Year=str_split_i(tree$Date_format, "-", 1)
library(dplyr)
years=sort(unique(tree$Year))
tree$dbh_change=NA
tree[which(tree$Year==1990), "dbh_change"]="no_change"
tree[which(tree$dbh_change=="no_change" |is.na(tree$dbh_change)), "dbh_change"]="dbh missing"
tree=tree[which(tree$Status=="L"),]
tree=tree[-which(tree$TagNo==999),]
tree=tree[which(is.na(tree$MacroPlotSize)),]
tree=tree[-which(tree$SubFrac==1000),]
#plot and tag!
for(x in 2:length(years)){
previous_year=years[x-1]
current_year=years[x]
plots=unique(tree[which(tree$Year==current_year), "MacroPlot.Name"])
for(p in 1:length(plots)){
tree_plot=tree[which(tree$MacroPlot.Name==plots[p]),]
tree=tree[-which(tree$MacroPlot.Name==plots[p]),]
trees_p=tree_plot[which(tree_plot$Year==previous_year),"TagNo"]
trees_c=tree_plot[which(tree_plot$Year==current_year), "TagNo"]
trees_c=intersect(trees_p, trees_c)
for(i in 1:length(trees_c)){
current_dbh=tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "DBH"]
previous_dbh=tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==previous_year), "DBH"]
if(length(current_dbh)==0 | length(previous_dbh)==0){
#do nothing?
}else{
if(length(current_dbh)>1 | length(previous_dbh)>1){
current_dbh=unique(current_dbh)
current_dbh=current_dbh[1]
previous_dbh=unique(previous_dbh)
previous_dbh=previous_dbh[1]}
if(is.na(previous_dbh) | is.na(current_dbh)){
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="dbh missing"
}else{
if(previous_dbh<current_dbh){
#increase
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="increase"
}else if(previous_dbh>current_dbh){
#decrease
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="decrease"
}else if(previous_dbh==current_dbh){
#stay same
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="same as previous year"
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==previous_year), "dbh_change"]="same as subsequent year"
}
}
}
}
tree=rbind(tree, tree_plot)
}
}
tree_2003=tree[which(tree$Year=="2003"),]
View(tree_2003)
tree_psme3=tree[which(tree$MacroPlot.Name=="PSME-03"),]
View(tree_psme3)
tree=read.csv("C:/Users/edeegan/OneDrive - DOI/Fire_project/Fire_project/SAGU_data/PSME/PSME_Trees - Individuals (metric)_XPT.csv")
library(tidyverse)
library(ggforce)
tree$Date_format=as.Date(tree$Date, format="%m/%d/%Y")
library(stringr)
tree$Year=str_split_i(tree$Date_format, "-", 1)
tree_psme3=tree[which(tree$MacroPlot.Name=="PSME-03" & tree$Year=="2008"),]
View(tree_psme3)
rm(list = ls())
tree=read.csv("C:/Users/edeegan/OneDrive - DOI/Fire_project/Fire_project/SAGU_data/PSME/PSME_Trees - Individuals (metric)_XPT.csv")
library(tidyverse)
library(ggforce)
tree$Date_format=as.Date(tree$Date, format="%m/%d/%Y")
library(stringr)
tree$Year=str_split_i(tree$Date_format, "-", 1)
library(dplyr)
years=sort(unique(tree$Year))
tree$dbh_change=NA
tree[which(tree$Year==1990), "dbh_change"]="dbh missing"
tree=tree[-which(tree$Status=="X"),]
tree=tree[-which(tree$TagNo==999),]
tree=tree[which(is.na(tree$MacroPlotSize)),]
tree=tree[-which(tree$SubFrac==1000),]
#plot and tag!
for(x in 2:length(years)){
previous_year=years[x-1]
current_year=years[x]
plots=unique(tree[which(tree$Year==current_year), "MacroPlot.Name"])
for(p in 1:length(plots)){
tree_plot=tree[which(tree$MacroPlot.Name==plots[p]),]
tree=tree[-which(tree$MacroPlot.Name==plots[p]),]
trees_p=tree_plot[which(tree_plot$Year==previous_year),"TagNo"]
trees_c=tree_plot[which(tree_plot$Year==current_year), "TagNo"]
trees_c=intersect(trees_p, trees_c)
for(i in 1:length(trees_c)){
current_dbh=tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "DBH"]
previous_dbh=tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==previous_year), "DBH"]
if(length(current_dbh)==0 | length(previous_dbh)==0){
#do nothing?
}else{
if(length(current_dbh)>1 | length(previous_dbh)>1){
current_dbh=unique(current_dbh)
current_dbh=current_dbh[1]
previous_dbh=unique(previous_dbh)
previous_dbh=previous_dbh[1]}
if(is.na(previous_dbh) | is.na(current_dbh)){
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="dbh missing"
}else{
if(previous_dbh<current_dbh){
#increase
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="increase"
}else if(previous_dbh>current_dbh){
#decrease
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="decrease"
}else if(previous_dbh==current_dbh){
#stay same
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="same as previous year"
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==previous_year), "dbh_change"]="same as subsequent year"
}
}
}
}
tree=rbind(tree, tree_plot)
}
}
#just dbh change values
tree=tree[which(tree$dbh_change=="same as previous year" | tree$dbh_change=="same as subsequent year" | is.na(tree$DBH)),]
tree=tree %>% arrange(TagNo, Date)
ggplot(tree, aes(x=dbh_change, fill=MacroPlot.Name))+
geom_bar(width=1)+facet_wrap(~Year)+
theme(axis.text.x= element_text(angle = 90, vjust = 0.5, hjust=1), panel.background = element_rect(fill = 'white'))+
labs(y="Number of trees")
tree=tree[-which(tree$Status=="D" & !is.na(tree$DBH)),]
#just dbh change values
tree=tree[which(tree$dbh_change=="same as previous year" | tree$dbh_change=="same as subsequent year" | is.na(tree$DBH)),]
rm(list = ls())
tree=read.csv("C:/Users/edeegan/OneDrive - DOI/Fire_project/Fire_project/SAGU_data/PSME/PSME_Trees - Individuals (metric)_XPT.csv")
library(tidyverse)
library(ggforce)
tree$Date_format=as.Date(tree$Date, format="%m/%d/%Y")
library(stringr)
tree$Year=str_split_i(tree$Date_format, "-", 1)
library(dplyr)
years=sort(unique(tree$Year))
tree$dbh_change=NA
tree[which(tree$Year==1990), "dbh_change"]="dbh missing"
tree=tree[-which(tree$Status=="X"),]
tree=tree[-which(tree$TagNo==999),]
tree=tree[which(is.na(tree$MacroPlotSize)),]
tree=tree[-which(tree$SubFrac==1000),]
#plot and tag!
for(x in 2:length(years)){
previous_year=years[x-1]
current_year=years[x]
plots=unique(tree[which(tree$Year==current_year), "MacroPlot.Name"])
for(p in 1:length(plots)){
tree_plot=tree[which(tree$MacroPlot.Name==plots[p]),]
tree=tree[-which(tree$MacroPlot.Name==plots[p]),]
trees_p=tree_plot[which(tree_plot$Year==previous_year),"TagNo"]
trees_c=tree_plot[which(tree_plot$Year==current_year), "TagNo"]
trees_c=intersect(trees_p, trees_c)
for(i in 1:length(trees_c)){
current_dbh=tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "DBH"]
previous_dbh=tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==previous_year), "DBH"]
if(length(current_dbh)==0 | length(previous_dbh)==0){
#do nothing?
}else{
if(length(current_dbh)>1 | length(previous_dbh)>1){
current_dbh=unique(current_dbh)
current_dbh=current_dbh[1]
previous_dbh=unique(previous_dbh)
previous_dbh=previous_dbh[1]}
if(is.na(previous_dbh) | is.na(current_dbh)){
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="dbh missing"
}else{
if(previous_dbh<current_dbh){
#increase
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="increase"
}else if(previous_dbh>current_dbh){
#decrease
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="decrease"
}else if(previous_dbh==current_dbh){
#stay same
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="same as previous year"
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==previous_year), "dbh_change"]="same as subsequent year"
}
}
}
}
tree=rbind(tree, tree_plot)
}
}
tree=tree[-which(tree$Status=="D" & !is.na(tree$DBH)),]
#just dbh change values
tree=tree[which(tree$dbh_change=="same as previous year" | tree$dbh_change=="same as subsequent year" | is.na(tree$DBH)),]
tree=tree %>% arrange(TagNo, Date)
ggplot(tree, aes(x=dbh_change, fill=MacroPlot.Name))+
geom_bar(width=1)+facet_wrap(~Year)+
theme(axis.text.x= element_text(angle = 90, vjust = 0.5, hjust=1), panel.background = element_rect(fill = 'white'))+
labs(y="Number of trees")
tree=tree[-which(tree$Status=="D" & !is.na(tree$DBH)),]
tree=tree %>% arrange(TagNo, Date)
ggplot(tree, aes(x=dbh_change, fill=MacroPlot.Name))+
geom_bar(width=1)+facet_wrap(~Year)+
theme(axis.text.x= element_text(angle = 90, vjust = 0.5, hjust=1), panel.background = element_rect(fill = 'white'))+
labs(y="Number of trees")
rm(list = ls())
tree=read.csv("C:/Users/edeegan/OneDrive - DOI/Fire_project/Fire_project/SAGU_data/PSME/PSME_Trees - Individuals (metric)_XPT.csv")
library(tidyverse)
library(ggforce)
tree$Date_format=as.Date(tree$Date, format="%m/%d/%Y")
library(stringr)
tree$Year=str_split_i(tree$Date_format, "-", 1)
library(dplyr)
years=sort(unique(tree$Year))
tree$dbh_change=NA
tree[which(tree$Year==1990), "dbh_change"]="dbh missing"
tree=tree[-which(tree$Status=="X"),]
tree=tree[-which(tree$TagNo==999),]
tree=tree[which(is.na(tree$MacroPlotSize)),]
tree=tree[-which(tree$SubFrac==1000),]
#plot and tag!
for(x in 2:length(years)){
previous_year=years[x-1]
current_year=years[x]
plots=unique(tree[which(tree$Year==current_year), "MacroPlot.Name"])
for(p in 1:length(plots)){
tree_plot=tree[which(tree$MacroPlot.Name==plots[p]),]
tree=tree[-which(tree$MacroPlot.Name==plots[p]),]
trees_p=tree_plot[which(tree_plot$Year==previous_year),"TagNo"]
trees_c=tree_plot[which(tree_plot$Year==current_year), "TagNo"]
trees_c=intersect(trees_p, trees_c)
for(i in 1:length(trees_c)){
current_dbh=tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "DBH"]
previous_dbh=tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==previous_year), "DBH"]
if(length(current_dbh)==0 | length(previous_dbh)==0){
#do nothing?
}else{
if(length(current_dbh)>1 | length(previous_dbh)>1){
current_dbh=unique(current_dbh)
current_dbh=current_dbh[1]
previous_dbh=unique(previous_dbh)
previous_dbh=previous_dbh[1]}
if(is.na(previous_dbh) | is.na(current_dbh)){
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="dbh missing"
}else{
if(previous_dbh<current_dbh){
#increase
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="increase"
}else if(previous_dbh>current_dbh){
#decrease
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="decrease"
}else if(previous_dbh==current_dbh){
#stay same
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="same as previous year"
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==previous_year), "dbh_change"]="same as subsequent year"
}
}
}
}
tree=rbind(tree, tree_plot)
}
}
#just dbh change values
tree=tree[which(tree$dbh_change=="same as previous year" | tree$dbh_change=="same as subsequent year" | is.na(tree$DBH)),]
tree=tree[-which(tree$Status=="D" & !is.na(tree$DBH)),]
tree=tree %>% arrange(TagNo, Date)
ggplot(tree, aes(x=dbh_change, fill=MacroPlot.Name))+
geom_bar(width=1)+facet_wrap(~Year)+
theme(axis.text.x= element_text(angle = 90, vjust = 0.5, hjust=1), panel.background = element_rect(fill = 'white'))+
labs(y="Number of trees")
#all in 2008
tags_to_replace=tree[which(tree$dbh_change=="dbh missing"), "TagNo"]
unique(tree[which(tree$Year=="2008"), "MacroPlot.Name"])
test=tree[which(tree$Year=="2023"),]
View(test)
rm(list = ls())
tree=read.csv("C:/Users/edeegan/OneDrive - DOI/Fire_project/Fire_project/SAGU_data/PSME/PSME_Trees - Individuals (metric)_XPT.csv")
library(tidyverse)
library(ggforce)
tree$Date_format=as.Date(tree$Date, format="%m/%d/%Y")
library(stringr)
tree$Year=str_split_i(tree$Date_format, "-", 1)
library(dplyr)
years=sort(unique(tree$Year))
tree$dbh_change=NA
tree[which(tree$Year==1990), "dbh_change"]="dbh missing"
tree=tree[-which(tree$Status=="X"),]
tree=tree[-which(tree$TagNo==999),]
tree=tree[which(is.na(tree$MacroPlotSize)),]
tree=tree[-which(tree$SubFrac==1000),]
#plot and tag!
for(x in 2:length(years)){
previous_year=years[x-1]
current_year=years[x]
plots=unique(tree[which(tree$Year==current_year), "MacroPlot.Name"])
for(p in 1:length(plots)){
tree_plot=tree[which(tree$MacroPlot.Name==plots[p]),]
tree=tree[-which(tree$MacroPlot.Name==plots[p]),]
trees_p=tree_plot[which(tree_plot$Year==previous_year),"TagNo"]
trees_c=tree_plot[which(tree_plot$Year==current_year), "TagNo"]
trees_c=intersect(trees_p, trees_c)
for(i in 1:length(trees_c)){
current_dbh=tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "DBH"]
previous_dbh=tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==previous_year), "DBH"]
if(length(current_dbh)==0 | length(previous_dbh)==0){
#do nothing?
}else{
if(length(current_dbh)>1 | length(previous_dbh)>1){
current_dbh=unique(current_dbh)
current_dbh=current_dbh[1]
previous_dbh=unique(previous_dbh)
previous_dbh=previous_dbh[1]}
if(is.na(previous_dbh) | is.na(current_dbh)){
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="dbh missing"
}else{
if(previous_dbh<current_dbh){
#increase
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="increase"
}else if(previous_dbh>current_dbh){
#decrease
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="decrease"
}else if(previous_dbh==current_dbh){
#stay same
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="same as previous year"
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==previous_year), "dbh_change"]="same as subsequent year"
}
}
}
}
tree=rbind(tree, tree_plot)
}
}
#just dbh change values
tree=tree[which(tree$dbh_change=="same as previous year" | tree$dbh_change=="same as subsequent year" | is.na(tree$DBH)),]
tree=tree[-which(tree$Status=="D" & !is.na(tree$DBH)),]
tree=tree[-which(tree$CrwnCl=="BBD" | tree$CrwnCl=="DD"),]
tree=tree %>% arrange(TagNo, Date)
ggplot(tree, aes(x=dbh_change, fill=MacroPlot.Name))+
geom_bar(width=1)+facet_wrap(~Year)+
theme(axis.text.x= element_text(angle = 90, vjust = 0.5, hjust=1), panel.background = element_rect(fill = 'white'))+
labs(y="Number of trees")
tree[which(tree$dbh_change==NA),]
tree[which(tree$dbh_change=="NA"),]
tree[which(is.na(tree$dbh_change)),]
#just dbh change values
tree=tree[which(tree$dbh_change=="same as previous year" | tree$dbh_change=="same as subsequent year" | is.na(tree$DBH)),]
tree=tree[-which(tree$Status=="D" & !is.na(tree$DBH)),]
tree=tree[-which(tree$CrwnCl=="BBD" | tree$CrwnCl=="DD"),]
tree[which(is.na(tree$dbh_change)),]
ggplot(tree, aes(x=dbh_change, fill=MacroPlot.Name))+
geom_bar(width=1)+facet_wrap(~Year)+
theme(axis.text.x= element_text(angle = 90, vjust = 0.5, hjust=1), panel.background = element_rect(fill = 'white'))+
labs(y="Number of trees")
rm(list = ls())
tree=read.csv("C:/Users/edeegan/OneDrive - DOI/Fire_project/Fire_project/SAGU_data/PSME/PSME_Trees - Individuals (metric)_XPT.csv")
library(tidyverse)
library(ggforce)
tree$Date_format=as.Date(tree$Date, format="%m/%d/%Y")
library(stringr)
tree$Year=str_split_i(tree$Date_format, "-", 1)
library(dplyr)
years=sort(unique(tree$Year))
tree$dbh_change=NA
tree[which(tree$Year==1990), "dbh_change"]="dbh missing"
tree=tree[-which(tree$Status=="X"),]
tree=tree[-which(tree$TagNo==999),]
tree=tree[which(is.na(tree$MacroPlotSize)),]
tree=tree[-which(tree$SubFrac==1000),]
#plot and tag!
for(x in 2:length(years)){
previous_year=years[x-1]
current_year=years[x]
plots=unique(tree[which(tree$Year==current_year), "MacroPlot.Name"])
for(p in 1:length(plots)){
tree_plot=tree[which(tree$MacroPlot.Name==plots[p]),]
tree=tree[-which(tree$MacroPlot.Name==plots[p]),]
trees_p=tree_plot[which(tree_plot$Year==previous_year),"TagNo"]
trees_c=tree_plot[which(tree_plot$Year==current_year), "TagNo"]
trees_c=intersect(trees_p, trees_c)
for(i in 1:length(trees_c)){
current_dbh=tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "DBH"]
previous_dbh=tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==previous_year), "DBH"]
if(length(current_dbh)==0 | length(previous_dbh)==0){
#do nothing?
}else{
if(length(current_dbh)>1 | length(previous_dbh)>1){
current_dbh=unique(current_dbh)
current_dbh=current_dbh[1]
previous_dbh=unique(previous_dbh)
previous_dbh=previous_dbh[1]}
if(is.na(previous_dbh) | is.na(current_dbh)){
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="dbh missing"
}else{
if(previous_dbh<current_dbh){
#increase
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="increase"
}else if(previous_dbh>current_dbh){
#decrease
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="decrease"
}else if(previous_dbh==current_dbh){
#stay same
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="same as previous year"
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==previous_year), "dbh_change"]="same as subsequent year"
}
}
}
}
tree=rbind(tree, tree_plot)
}
}
#just dbh change values
tree=tree[which(tree$dbh_change=="same as previous year" | tree$dbh_change=="same as subsequent year" | is.na(tree$DBH)),]
tree=tree[-which(tree$Status=="D" & !is.na(tree$DBH)),]
tree=tree[-which(tree$CrwnCl=="BBD" | tree$CrwnCl=="DD"),]
tree=tree %>% arrange(TagNo, Date)
ggplot(tree, aes(x=dbh_change, fill=MacroPlot.Name))+
geom_bar(width=1)+facet_wrap(~Year)+
theme(axis.text.x= element_text(angle = 90, vjust = 0.5, hjust=1), panel.background = element_rect(fill = 'white'))+
labs(y="Number of trees")
tree[which(is.na(tree$dbh_change)),]
tree[which(is.na(tree$dbh_change)),"dbh_change"]="dbh missing"
tree=tree %>% arrange(TagNo, Date)
ggplot(tree, aes(x=dbh_change, fill=MacroPlot.Name))+
geom_bar(width=1)+facet_wrap(~Year)+
theme(axis.text.x= element_text(angle = 90, vjust = 0.5, hjust=1), panel.background = element_rect(fill = 'white'))+
labs(y="Number of trees")
#all in 2008
tags_to_replace=tree[which(tree$dbh_change=="dbh missing"), "TagNo"]
rm(list = ls())
tree=read.csv("C:/Users/edeegan/OneDrive - DOI/Fire_project/Fire_project/SAGU_data/PSME/PSME_Trees - Individuals (metric)_XPT.csv")
library(tidyverse)
library(ggforce)
tree$Date_format=as.Date(tree$Date, format="%m/%d/%Y")
library(stringr)
tree$Year=str_split_i(tree$Date_format, "-", 1)
library(dplyr)
years=sort(unique(tree$Year))
tree$dbh_change=NA
tree[which(tree$Year==1990), "dbh_change"]="dbh missing"
tree=tree[-which(tree$Status=="X"),]
tree=tree[-which(tree$TagNo==999),]
tree=tree[which(is.na(tree$MacroPlotSize)),]
tree=tree[-which(tree$SubFrac==1000),]
#plot and tag!
for(x in 2:length(years)){
previous_year=years[x-1]
current_year=years[x]
plots=unique(tree[which(tree$Year==current_year), "MacroPlot.Name"])
for(p in 1:length(plots)){
tree_plot=tree[which(tree$MacroPlot.Name==plots[p]),]
tree=tree[-which(tree$MacroPlot.Name==plots[p]),]
trees_p=tree_plot[which(tree_plot$Year==previous_year),"TagNo"]
trees_c=tree_plot[which(tree_plot$Year==current_year), "TagNo"]
trees_c=intersect(trees_p, trees_c)
for(i in 1:length(trees_c)){
current_dbh=tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "DBH"]
previous_dbh=tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==previous_year), "DBH"]
if(length(current_dbh)==0 | length(previous_dbh)==0){
#do nothing?
}else{
if(length(current_dbh)>1 | length(previous_dbh)>1){
current_dbh=unique(current_dbh)
current_dbh=current_dbh[1]
previous_dbh=unique(previous_dbh)
previous_dbh=previous_dbh[1]}
if(is.na(previous_dbh) | is.na(current_dbh)){
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="dbh missing"
}else{
if(previous_dbh<current_dbh){
#increase
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="increase"
}else if(previous_dbh>current_dbh){
#decrease
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="decrease"
}else if(previous_dbh==current_dbh){
#stay same
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==current_year), "dbh_change"]="same as previous year"
tree_plot[which(tree_plot$TagNo==trees_c[i] & tree_plot$Year==previous_year), "dbh_change"]="same as subsequent year"
}
}
}
}
tree=rbind(tree, tree_plot)
}
}
#just look at 2008
tree_2008=tree[which(tree$Year=="2008"),]
View(tree_2008)
ggplot(aes(x=Status, y=DBH, color=Status))+geom_bar(stat="identity")+facet_wrap(~Year)
ggplot(tree_2008, aes(x=Status, y=DBH, color=Status))+geom_bar(stat="identity")+facet_wrap(~Year)
ggplot(tree_2008, aes(x=Status, y=DBH, color=Status))+geom_bar(stat="identity")+facet_wrap(~MacroPlot.Name)
ggplot(tree_2008, aes(x=Status, y=DBH, color=Status))+geom_point()+facet_wrap(~MacroPlot.Name)
ggplot(tree_2008, aes(x=Status, y=DBH, color=dbh_change))+geom_point()+facet_wrap(~MacroPlot.Name)
tag=tree[which(tree$TagNo==303),]
View(tag)
ggplot(tree_2008, aes(x=Status, y=DBH, color=dbh_change))+geom_point()+facet_wrap(~MacroPlot.Name)+theme_classic()
ggsave("2008dbh.png")
ggsave("PSME_Plots/2008dbh.png", width=8, height=4)
#just dbh change values
tree=tree[which(tree$dbh_change=="same as previous year" | tree$dbh_change=="same as subsequent year" | is.na(tree$DBH)),]
tree=tree[-which(tree$Status=="D" & !is.na(tree$DBH)),]
tree=tree[-which(tree$CrwnCl=="BBD" | tree$CrwnCl=="DD"),]
tree[which(is.na(tree$dbh_change)),"dbh_change"]="dbh missing"
tree=tree %>% arrange(TagNo, Date)
ggplot(tree, aes(x=dbh_change, fill=MacroPlot.Name))+
geom_bar(width=1)+facet_wrap(~Year)+
theme(axis.text.x= element_text(angle = 90, vjust = 0.5, hjust=1), panel.background = element_rect(fill = 'white'))+
labs(y="Number of trees")
ggsave("PSME_Plots/dbh_transfer.png", width=8, height=4)
ggsave("PSME_Plots/dbh_transfer.png", width=8, height=5)
# install.packages("devtools")
devtools::install_github("nationalparkservice/EMLeditor")
